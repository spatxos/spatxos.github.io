---
title: .net core3.1 abp动态菜单和动态权限（动态菜单实现和动态权限添加）  （三）
date: 2020-06-13T18:16:00
author: wpzblog
tags: ["abp","netcore"]
---
<p>我们来创建动态菜单吧&nbsp;</p>
<div class="cnblogs_code">
<pre>首先，先对动态菜单的概念、操作、流程进行约束：<br />1.Host和各个Tenant有自己的自定义菜单<br />2.Host和各个Tenant的权限与自定义菜单相关联<br />2.Tenant有一套默认的菜单，规定对应的TenantId=-1，在添加租户时自动将标准菜单和标准菜单的权限初始化到添加的租户</pre>
</div>
<h2>一、先实现菜单在数据库中的增删改查</h2>
<h3>第一步：创建表、实体，添加DbContext</h3>
<p>我们需要创建一个菜单表，延续Abp的命名方法，表名叫AbpMenus吧（菜单和权限、验证我们要关联，所以文件尽量放在Authorization文件夹下）</p>
<p>把创建的实体放在AbpLearn.Core/Authorization下面，新建一个Menus文件夹，再创建Menus实体</p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> AbpMenus : Entity&lt;int&gt;<span style="color: #000000;">
    {
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> MenuName { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> PageName { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Name { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Url { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> Icon { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> ParentId { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span> IsActive { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Orders { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span>? TenantId { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }
    }</span></pre>
</div>
<div class="cnblogs_code">
<pre>如果翻过源码中实体的定义，可以发现很多实体的继承，例如：<br /><br />1.继承接口 IMayHaveTenant，继承后生成的sql语句将自动增加TenantId的查询条件，表中必须包含TenantId列<br />2.继承接口 IPassivable，继承后表中必须包含IsActive列<br />3.继承接口 FullAuditedEntity&lt;TPrimaryKey&gt; TPrimaryKey可以是long、int等值类型，必须包含IsDeleted、DeleterUserId、DeletionTime，其中这个接口<br />        还继承了AuditedEntity&lt;TPrimaryKey&gt;, IFullAudited, IAudited, ICreationAudited, IHasCreationTime, IModificationAudited, IHasModificationTime, IDeletionAudited, IHasDeletionTime, ISoftDelete，这些父类型、接口的定义自己F12就可以看到</pre>
</div>
<p>&nbsp;</p>
<p>AbpLearn.EntityFrameworkCore/EntityFrameworkCore/AbpLearnDbContext.cs增加DbSet</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> AbpLearnDbContext : AbpZeroDbContext&lt;Tenant, Role, User, AbpLearnDbContext&gt;<span style="color: #000000;">
    {
        </span><span style="color: #008000;">/*</span><span style="color: #008000;"> Define a DbSet for each entity of the application </span><span style="color: #008000;">*/</span>
        
        <span style="color: #0000ff;">public</span> AbpLearnDbContext(DbContextOptions&lt;AbpLearnDbContext&gt;<span style="color: #000000;"> options)
            : </span><span style="color: #0000ff;">base</span><span style="color: #000000;">(options)
        {
            
        }

        </span><span style="color: #0000ff;">public</span> DbSet&lt;AbpMenus&gt; AbpMenus { <span style="color: #0000ff;">set</span>; <span style="color: #0000ff;">get</span><span style="color: #000000;">; }

    }</span></pre>
</div>
<p>再去数据库中添加AbpMenus表 字段长度请自行调整</p>
<div class="cnblogs_code">
<p>DROP TABLE IF EXISTS `AbpMenus`;<br />CREATE TABLE `AbpMenus` (<br />  `Id` int NOT NULL AUTO_INCREMENT,<br />  `MenuName` varchar(50) DEFAULT NULL,<br />  `PageName` varchar(50) DEFAULT NULL,<br />  `LName` varchar(50) DEFAULT NULL,<br />  `Url` varchar(50) DEFAULT NULL,<br />  `Icon` varchar(20) DEFAULT NULL,<br />  `ParentId` int DEFAULT NULL,<br />  `IsActive` bit(1) NOT NULL DEFAULT b'0',<br />  `Orders` int DEFAULT NULL,<br />  `TenantId` int DEFAULT NULL,<br />  PRIMARY KEY (`Id`)<br />) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</p>














</div>
<h3>第二步：添加Service和Dto</h3>
<p>AbpLearn.Application/Authorization下添加Menus文件夹，然后添加IMenusAppService、MenusAppService，然后添加Dto文件夹</p>
<p><img src="/cnblogs/13096427/789895-20200611210551368-1414077737.png" alt="" loading="lazy" /></p>
<h3>第三步：添加控制器和前台页面、js</h3>
<p>Controller文件，MenusController.cs</p>
<p>&nbsp;<img src="/cnblogs/13096427/789895-20200613120436495-1821816057.png" alt="" loading="lazy" /></p>
<p>&nbsp;前台添加Menus及对应的js文件，可以简单省事的把其他文件夹复制粘贴一份，然后关键词修改下</p>
<p><img src="/cnblogs/13096427/789895-20200611210653597-521335150.png" alt="" loading="lazy" /></p>
<p>这些文件太多了，我会把这套代码上传到github中，文章最低部会把链接挂出来</p>
<p>添加完之后我们就可以生成预览一下Menus，因为SetNavigation中未将Menus的url加进去，我们自己手打链接进入<img src="/cnblogs/13096427/789895-20200613122433371-1340406219.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>此时， 我们的菜单这一块的crud已经做好了，我们可以看到有一个Host管理员这个部分是什么意思哪？</p>
<p>我们为了在当前Host中可以控制所有租户的菜单和权限，将当前Host、标准菜单、租户做一个select，代码如下</p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ChangeModalViewModel
    {
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span>? TenantId { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span> TenancyName { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span>? TenantMenuType { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }


        </span><span style="color: #0000ff;">public</span> List&lt;ComboboxItemDto&gt; TeneacyItems { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }
    }</span></pre>
</div>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">async</span> Task&lt;IActionResult&gt; IndexAsync(<span style="color: #0000ff;">int</span>? id = <span style="color: #800080;">0</span><span style="color: #000000;">)
        {
            </span><span style="color: #0000ff;">var</span> loginTenant = id &lt;= <span style="color: #800080;">0</span> ? <span style="color: #0000ff;">null</span> : _tenantManager.GetById((<span style="color: #0000ff;">int</span><span style="color: #000000;">)id);

            </span><span style="color: #0000ff;">var</span> viewModel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ChangeModalViewModel
            {
                TenancyName </span>= loginTenant?<span style="color: #000000;">.TenancyName,
                TenantId </span>=<span style="color: #000000;"> id
            };

            viewModel.TeneacyItems </span>=<span style="color: #000000;"> _tenantManager.Tenants
                .Select(p </span>=&gt; <span style="color: #0000ff;">new</span> ComboboxItemDto(p.Id.ToString(), p.Name) { IsSelected = viewModel.TenancyName ==<span style="color: #000000;"> p.TenancyName })
                .ToList();

            viewModel.TeneacyItems.Add(</span><span style="color: #0000ff;">new</span> ComboboxItemDto(<span style="color: #800000;">"</span><span style="color: #800000;">0</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">Host管理员</span><span style="color: #800000;">"</span>) { IsSelected = id == <span style="color: #800080;">0</span><span style="color: #000000;"> });

            viewModel.TeneacyItems.Add(</span><span style="color: #0000ff;">new</span> ComboboxItemDto(<span style="color: #800000;">"</span><span style="color: #800000;">-1</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">默认菜单</span><span style="color: #800000;">"</span>) { IsSelected = id == -<span style="color: #800080;">1</span><span style="color: #000000;"> });

            ViewBag.LoginInfo </span>= <span style="color: #0000ff;">await</span><span style="color: #000000;"> _sessionAppService.GetCurrentLoginInformations();

            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> View(viewModel);
        }</span></pre>
</div>
<p>然后在Index.cshtml中添加或修改</p>
<div class="cnblogs_code">
<pre>@model ChangeModalViewModel  // 添加<br /><br /><br /></pre>
<p>&nbsp; @await Html.PartialAsync("~/Views/Menus/Index.AdvancedSearch.cshtml", Model)&nbsp; //修改</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; @await Html.PartialAsync("~/Views/Menus/_CreateModal.cshtml",Model.TenantId)&nbsp; //修改</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; //添加</p>
<p>&nbsp; $("#ChangeTenancyName").change(function (e) {<br />&nbsp; &nbsp; &nbsp;location.href = "/Menus/Index/" + this.options[this.selectedIndex].value;<br />&nbsp; });</p>














</div>
<p>修改_CreateModal.cshtml</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('eb1b27ba-ce7d-494f-b2a1-896ae90bfd6b')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_eb1b27ba-ce7d-494f-b2a1-896ae90bfd6b" class="code_img_closed" /><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_eb1b27ba-ce7d-494f-b2a1-896ae90bfd6b" class="code_img_opened" style="display: none;" />
<div id="cnblogs_code_open_eb1b27ba-ce7d-494f-b2a1-896ae90bfd6b" class="cnblogs_code_hide">
<pre><span style="color: #000000;">@using Abp.Authorization.Users
@using Abp.MultiTenancy
@using AbpLearn.MultiTenancy
@using AbpLearn.Web.Models.Common.Modals
@model </span><span style="color: #0000ff;">int</span><span style="color: #000000;">
@{
    Layout </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
}
</span>&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">modal fade</span><span style="color: #800000;">"</span> id=<span style="color: #800000;">"</span><span style="color: #800000;">MenuCreateModal</span><span style="color: #800000;">"</span> tabindex=<span style="color: #800000;">"</span><span style="color: #800000;">-1</span><span style="color: #800000;">"</span> role=<span style="color: #800000;">"</span><span style="color: #800000;">dialog</span><span style="color: #800000;">"</span> aria-labelledby=<span style="color: #800000;">"</span><span style="color: #800000;">MenuCreateModalLabel</span><span style="color: #800000;">"</span> data-backdrop=<span style="color: #800000;">"</span><span style="color: #800000;">static</span><span style="color: #800000;">"</span>&gt;
    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">modal-dialog modal-lg</span><span style="color: #800000;">"</span> role=<span style="color: #800000;">"</span><span style="color: #800000;">document</span><span style="color: #800000;">"</span>&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">modal-content</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
            @await Html.PartialAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">~/Views/Shared/Modals/_ModalHeader.cshtml</span><span style="color: #800000;">"</span>, <span style="color: #0000ff;">new</span> ModalHeaderViewModel(L(<span style="color: #800000;">"</span><span style="color: #800000;">CreateNewMenu</span><span style="color: #800000;">"</span><span style="color: #000000;">)))
            </span>&lt;form name=<span style="color: #800000;">"</span><span style="color: #800000;">systemMenuCreateForm</span><span style="color: #800000;">"</span> role=<span style="color: #800000;">"</span><span style="color: #800000;">form</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-horizontal</span><span style="color: #800000;">"</span>&gt;
                &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">modal-body</span><span style="color: #800000;">"</span>&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">MenuName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">MenuName</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> required minlength=<span style="color: #800000;">"</span><span style="color: #800000;">2</span><span style="color: #800000;">"</span>&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">LName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">LName</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> required&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">Url</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">Url</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">PageName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">PageName</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">ParentId</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">ParentId</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">Orders</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">Orders</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row</span><span style="color: #800000;">"</span>&gt;
                        &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">CreateMenuIsActive</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">IsActive</span><span style="color: #800000;">"</span>)&lt;/label&gt;
                        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                            &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">CreateMenuIsActive</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">checkbox</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">IsActive</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">true</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">checked</span> /&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">hidden</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">TenantId</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@(Model)</span><span style="color: #800000;">"</span> /&gt;<span style="color: #000000;">
                @await Html.PartialAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">~/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml</span><span style="color: #800000;">"</span><span style="color: #000000;">)
            </span>&lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p>修改_EditModal.cshtml</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('3cac859e-397f-41e9-9596-025466ee5cbc')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_3cac859e-397f-41e9-9596-025466ee5cbc" class="code_img_closed" /><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_3cac859e-397f-41e9-9596-025466ee5cbc" class="code_img_opened" style="display: none;" />
<div id="cnblogs_code_open_3cac859e-397f-41e9-9596-025466ee5cbc" class="cnblogs_code_hide">
<pre><span style="color: #000000;">@using AbpLearn.Authorization.Menus.Dto
@using AbpLearn.Web.Models.Common.Modals
@model MenuDto
@{
    Layout </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
}
@await Html.PartialAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">~/Views/Shared/Modals/_ModalHeader.cshtml</span><span style="color: #800000;">"</span>, <span style="color: #0000ff;">new</span> ModalHeaderViewModel(L(<span style="color: #800000;">"</span><span style="color: #800000;">EditMenu</span><span style="color: #800000;">"</span><span style="color: #000000;">)))
</span>&lt;form name=<span style="color: #800000;">"</span><span style="color: #800000;">MenuEditForm</span><span style="color: #800000;">"</span> role=<span style="color: #800000;">"</span><span style="color: #800000;">form</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-horizontal</span><span style="color: #800000;">"</span>&gt;
    &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">hidden</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">Id</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.Id</span><span style="color: #800000;">"</span> /&gt;
    &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">modal-body</span><span style="color: #800000;">"</span>&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">tenancy-name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">MenuName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">tenancy-name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">MenuName</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.MenuName</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">64</span><span style="color: #800000;">"</span> minlength=<span style="color: #800000;">"</span><span style="color: #800000;">2</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">LName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">LName</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.LName</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">128</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">Url</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">Url</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.Url</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">128</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">PageName</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">PageName</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.PageName</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">128</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">ParentId</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">ParentId</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.ParentId</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">128</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row required</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">Orders</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">Orders</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.Orders</span><span style="color: #800000;">"</span> required maxlength=<span style="color: #800000;">"</span><span style="color: #800000;">128</span><span style="color: #800000;">"</span>&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group row</span><span style="color: #800000;">"</span>&gt;
            &lt;label <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-3 col-form-label</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">for</span>=<span style="color: #800000;">"</span><span style="color: #800000;">isactive</span><span style="color: #800000;">"</span>&gt;@L(<span style="color: #800000;">"</span><span style="color: #800000;">IsActive</span><span style="color: #800000;">"</span>)&lt;/label&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">col-md-9</span><span style="color: #800000;">"</span>&gt;
                &lt;input id=<span style="color: #800000;">"</span><span style="color: #800000;">isactive</span><span style="color: #800000;">"</span> type=<span style="color: #800000;">"</span><span style="color: #800000;">checkbox</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">IsActive</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">true</span><span style="color: #800000;">"</span> @(Model.IsActive ? <span style="color: #800000;">"</span><span style="color: #800000;">checked</span><span style="color: #800000;">"</span> : <span style="color: #800000;">""</span>) /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;<span style="color: #000000;">
    @await Html.PartialAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">~/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span>&lt;/form&gt;

&lt;script src=<span style="color: #800000;">"</span><span style="color: #800000;">~/view-resources/Views/Menus/_EditModal.js</span><span style="color: #800000;">"</span> asp-append-version=<span style="color: #800000;">"</span><span style="color: #800000;">true</span><span style="color: #800000;">"</span>&gt;&lt;/script&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>修改Index.AdvancedSearch.cshtml</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">@using AbpLearn.Web.Views.Shared.Components.TenantChange
@using Abp.Application.Services.Dto
@model ChangeModalViewModel

    </span>&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">abp-advanced-search</span><span style="color: #800000;">"</span>&gt;
        &lt;form id=<span style="color: #800000;">"</span><span style="color: #800000;">MenusSearchForm</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-horizontal</span><span style="color: #800000;">"</span>&gt;
            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">hidden</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">TenantId</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">@Model.TenantId</span><span style="color: #800000;">"</span> /&gt;
            &lt;/form&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-horizontal</span><span style="color: #800000;">"</span>&gt;
                &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">form-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
                    @Html.DropDownList(
                       </span><span style="color: #800000;">"</span><span style="color: #800000;">ChangeTenancyNames</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                       Model.TeneacyItems.Select(i </span>=&gt;<span style="color: #000000;"> i.ToSelectListItem()),
                       </span><span style="color: #0000ff;">new</span> { @class = <span style="color: #800000;">"</span><span style="color: #800000;">form-control edited</span><span style="color: #800000;">"</span>, id = <span style="color: #800000;">"</span><span style="color: #800000;">ChangeTenancyName</span><span style="color: #800000;">"</span><span style="color: #000000;"> })
                </span>&lt;/div&gt;
            &lt;/div&gt;
    &lt;/div&gt;</pre>
</div>
<p>因为在abp里面加载当前列表调用的是abp.services.app.menus.getAll方法，我们还需要对MenusAppService中的GetAllAsync做一下修改</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">    [Serializable]
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MenusPagedResultRequestDto: PagedResultRequestDto, IPagedAndSortedResultRequest
    {
        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">virtual</span> <span style="color: #0000ff;">int</span>? TenantId { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">virtual</span> <span style="color: #0000ff;">string</span> Sorting { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

        </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">virtual</span> <span style="color: #0000ff;">bool</span> ShowAll { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span><span style="color: #000000;">; }

    }</span></pre>
</div>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">#region</span> 查询全部菜单
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 查询全部菜单
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="input"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">async</span> Task&lt;PagedResultDto&lt;MenuDto&gt;&gt;<span style="color: #000000;"> GetAllAsync(MenusPagedResultRequestDto input)
        {
            IQueryable</span>&lt;AbpMenus&gt;<span style="color: #000000;"> query;

            query </span>= CreateFilteredQuery(input).Where(o =&gt; o.TenantId == (input.TenantId == <span style="color: #800080;">0</span> ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : input.TenantId));

            </span><span style="color: #0000ff;">var</span> totalCount = <span style="color: #0000ff;">await</span><span style="color: #000000;"> AsyncQueryableExecuter.CountAsync(query);

            query </span>=<span style="color: #000000;"> ApplySorting(query, input);
            </span><span style="color: #0000ff;">if</span> (!input.ShowAll) query =<span style="color: #000000;"> ApplyPaging(query, input);

            </span><span style="color: #0000ff;">var</span> entities = <span style="color: #0000ff;">await</span><span style="color: #000000;"> AsyncQueryableExecuter.ToListAsync(query);

            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> PagedResultDto&lt;MenuDto&gt;<span style="color: #000000;">(
                totalCount,
                entities.Select(MapToEntityDto).ToList()
            );
        }

        </span><span style="color: #0000ff;">#endregion</span></pre>
</div>
<p>这样，我们在选中下面中的任意一个Tenant时，将会跳到对应的菜单里面了</p>
<p>&nbsp;</p>
<p><img src="/cnblogs/13096427/789895-20200613122549077-374827601.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;我们先把Host管理员菜单和默认菜单配置一下</p>
<p><img src="/cnblogs/13096427/789895-20200613131544727-322024248.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;<img src="/cnblogs/13096427/789895-20200613131507643-1916575069.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>二、实现添加租户时，初始化标准菜单和权限</h2>
<p>首先我们找到添加租户的地方，去TenantAppService里面去找，可以看到有CreateAsync的重写</p>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">async</span> Task&lt;TenantDto&gt;<span style="color: #000000;"> CreateAsync(CreateTenantDto input)
        {
            CheckCreatePermission();

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create tenant</span>
            <span style="color: #0000ff;">var</span> tenant = ObjectMapper.Map&lt;Tenant&gt;<span style="color: #000000;">(input);
            tenant.ConnectionString </span>=<span style="color: #000000;"> input.ConnectionString.IsNullOrEmpty()
                </span>? <span style="color: #0000ff;">null</span><span style="color: #000000;">
                : SimpleStringCipher.Instance.Encrypt(input.ConnectionString);

            </span><span style="color: #0000ff;">var</span> defaultEdition = <span style="color: #0000ff;">await</span><span style="color: #000000;"> _editionManager.FindByNameAsync(EditionManager.DefaultEditionName);
            </span><span style="color: #0000ff;">if</span> (defaultEdition != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                tenant.EditionId </span>=<span style="color: #000000;"> defaultEdition.Id;
            }

            </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _tenantManager.CreateAsync(tenant);
            </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get new tenant's id.

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create tenant database</span>
<span style="color: #000000;">            _abpZeroDbMigrator.CreateOrMigrateForTenant(tenant);

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> We are working entities of new tenant, so changing tenant filter</span>
            <span style="color: #0000ff;">using</span><span style="color: #000000;"> (CurrentUnitOfWork.SetTenantId(tenant.Id))
            {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create static roles for new tenant</span>
                CheckErrors(<span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.CreateStaticRoles(tenant.Id));

                </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get static role ids

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Grant all permissions to admin role</span>
                <span style="color: #0000ff;">var</span> adminRole = _roleManager.Roles.Single(r =&gt; r.Name ==<span style="color: #000000;"> StaticRoleNames.Tenants.Admin);
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.GrantAllPermissionsAsync(adminRole);

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create admin user for the tenant</span>
                <span style="color: #0000ff;">var</span> adminUser =<span style="color: #000000;"> User.CreateTenantAdminUser(tenant.Id, input.AdminEmailAddress);
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.InitializeOptionsAsync(tenant.Id);
                CheckErrors(</span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.CreateAsync(adminUser, User.DefaultPassword));
                </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get admin user's id

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Assign admin user to role!</span>
                CheckErrors(<span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.AddToRoleAsync(adminUser, adminRole.Name));
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> CurrentUnitOfWork.SaveChangesAsync();
            }

            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> MapToEntityDto(tenant);
        }</span></pre>
</div>
<p>我们需要做的是，在&nbsp;using (CurrentUnitOfWork.SetTenantId(tenant.Id)) 的内部尾部添加赋予菜单和权限的方法即可</p>
<p>赋予菜单和权限的方法我们分开写，都放在MenusAppService中，</p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> IMenusAppService : IAsyncCrudAppService&lt;MenuDto, <span style="color: #0000ff;">int</span>, MenusPagedResultRequestDto, CreateMenuDto, MenuDto&gt;<span style="color: #000000;">
    {
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 赋予默认菜单
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="input"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        Task GiveMenusAsync(EntityDto&lt;<span style="color: #0000ff;">int</span>&gt;<span style="color: #000000;"> input);

        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 赋予当前租户Admin角色菜单权限
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="input"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        Task GivePermissionsAsync(EntityDto&lt;<span style="color: #0000ff;">int</span>&gt;<span style="color: #000000;"> input);
    }</span></pre>
</div>
<div class="cnblogs_code">
<pre>        #region 赋予默认菜单
        public async Task GiveMenusAsync(EntityDto&lt;int&gt; input)
        {
            if (input.Id &gt; 0)
            {
                var tenant = await _tenantManager.GetByIdAsync(input.Id);

                using (_unitOfWorkManager.Current.SetTenantId(tenant.Id))
                {
                    var query = CreateFilteredQuery(new MenusPagedResultRequestDto()).Where(o =&gt; o.TenantId == tenant.Id);

                    var systemMenus = await AsyncQueryableExecuter.ToListAsync(query);

                    if (!systemMenus.Any())
                    {
                        query = CreateFilteredQuery(new MenusPagedResultRequestDto()).Where(o =&gt; o.TenantId == -1);

                        var defaultMenus = await AsyncQueryableExecuter.ToListAsync(query);
                        if (defaultMenus.Any())
                        {
                            List&lt;MenusInsert&gt; GetMenusInserts(List&lt;AbpMenus&gt; abpMenus,int parentId = 0)
                            {
                                List&lt;MenusInsert&gt; menusInserts = new List&lt;MenusInsert&gt;();
                                foreach (var entity in abpMenus.Where(o =&gt; o.ParentId == parentId))
                                {
                                    var insert = new MenusInsert()
                                    {
                                        LName = entity.LName,
                                        MenuName = entity.MenuName,
                                        PageName = entity.PageName,
                                        Icon = entity.Icon,
                                        Url = entity.Url,
                                        IsActive = entity.IsActive,
                                        Orders = entity.Orders,
                                        ParentId = entity.ParentId,
                                        TenantId = tenant.Id
                                    };
                                    insert.menusInserts = GetMenusInserts(abpMenus, entity.Id);
                                    menusInserts.Add(insert);
                                }
                                return menusInserts;
                            }

                            async Task InsertMenusAsync(List&lt;MenusInsert&gt; inserts,int parentId = 0)
                            {
                                foreach (var insert in inserts)
                                {
                                    var entity = await CreateAsync(new AbpMenus()
                                    {
                                        LName = insert.LName,
                                        MenuName = insert.MenuName,
                                        PageName = insert.PageName,
                                        Icon = insert.Icon,
                                        Url = insert.Url,
                                        IsActive = insert.IsActive,
                                        Orders = insert.Orders,
                                        ParentId = parentId,
                                        TenantId = tenant.Id
                                    });
                                    if (insert.menusInserts.Any())
                                    {
                                        await InsertMenusAsync(insert.menusInserts, entity.Id);
                                    }
                                }
                            }
                            await InsertMenusAsync(GetMenusInserts(defaultMenus));
                            
                        }
                    }
                }
            }

        }
        #endregion


        <span style="color: #0000ff;">#region</span> 赋予当前租户Admin角色菜单权限
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 赋予当前租户Admin角色菜单权限
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="input"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">async</span> Task GivePermissionsAsync(EntityDto&lt;<span style="color: #0000ff;">int</span>&gt;<span style="color: #000000;"> input)
        {
            </span><span style="color: #0000ff;">if</span> (input.Id &gt; <span style="color: #800080;">0</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">var</span> tenant = <span style="color: #0000ff;">await</span><span style="color: #000000;"> _tenantManager.GetByIdAsync(input.Id);

                </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (_unitOfWorkManager.Current.SetTenantId(tenant.Id))
                {
                    </span><span style="color: #0000ff;">var</span> adminRoles = <span style="color: #0000ff;">await</span> _roleRepository.GetAllListAsync(o =&gt; o.Name == StaticRoleNames.Tenants.Admin &amp;&amp; o.TenantId ==<span style="color: #000000;"> tenant.Id);
                    </span><span style="color: #0000ff;">if</span> (adminRoles.FirstOrDefault() != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                    {
                        </span><span style="color: #0000ff;">var</span> adminRole =<span style="color: #000000;"> adminRoles.FirstOrDefault();

                        </span><span style="color: #0000ff;">var</span> query = CreateFilteredQuery(<span style="color: #0000ff;">new</span> MenusPagedResultRequestDto()).Where(o =&gt; o.TenantId ==<span style="color: #000000;"> tenant.Id);

                        </span><span style="color: #0000ff;">var</span> systemMenus = <span style="color: #0000ff;">await</span><span style="color: #000000;"> AsyncQueryableExecuter.ToListAsync(query);

                        </span><span style="color: #0000ff;">var</span> permissions =<span style="color: #000000;"> ConvertTenantPermissions(systemMenus);

                        </span><span style="color: #008000;">//</span><span style="color: #008000;">await _roleManager.ResetAllPermissionsAsync(adminRole.FirstOrDefault()); </span><span style="color: #008000;">//</span><span style="color: #008000;">重置授权</span>

                        <span style="color: #0000ff;">var</span> active_BatchCount = <span style="color: #800080;">10</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">var</span> active_permissions = ConvertTenantPermissions(systemMenus.Where(o =&gt;<span style="color: #000000;"> o.IsActive).ToList());
                        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; active_permissions.Count(); i += <span style="color: #800080;">10</span>)<span style="color: #008000;">//</span><span style="color: #008000;">每次后移5位</span>
<span style="color: #000000;">                        {
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">await _roleManager.SetGrantedPermissionsAsync(adminRole.FirstOrDefault().Id, active_permissions.Take(active_BatchCount).Skip(i));</span>
                            <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> notActive_permission <span style="color: #0000ff;">in</span><span style="color: #000000;"> active_permissions.Take(active_BatchCount).Skip(i))
                            {
                                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.GrantPermissionAsync(adminRole, notActive_permission);
                            }
                            active_BatchCount </span>+= <span style="color: #800080;">10</span>;<span style="color: #008000;">//</span><span style="color: #008000;">每次从数组中选出N+10位，skip前N位</span>
<span style="color: #000000;">                        }

                        </span><span style="color: #0000ff;">var</span> notActive_BatchCount = <span style="color: #800080;">10</span><span style="color: #000000;">;
                        </span><span style="color: #0000ff;">var</span> notActive_permissions = ConvertTenantPermissions(systemMenus.Where(o =&gt; !<span style="color: #000000;">o.IsActive).ToList());
                        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; notActive_permissions.Count(); i += <span style="color: #800080;">10</span>)<span style="color: #008000;">//</span><span style="color: #008000;">每次后移5位</span>
<span style="color: #000000;">                        {
                            </span><span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> notActive_permission <span style="color: #0000ff;">in</span><span style="color: #000000;"> notActive_permissions.Take(notActive_BatchCount).Skip(i))
                            {
                                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.ProhibitPermissionAsync(adminRole, notActive_permission);
                            }
                            notActive_BatchCount </span>+= <span style="color: #800080;">10</span>;<span style="color: #008000;">//</span><span style="color: #008000;">每次从数组中选出N+10位，skip前N位</span>
<span style="color: #000000;">                        }
                    }
                    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                    {
                        </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> AbpDbConcurrencyException(<span style="color: #800000;">"</span><span style="color: #800000;">未获取到当前租户的Admin角色！</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                    }
                }
            }
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
            {
                </span><span style="color: #0000ff;">var</span> adminRoles = <span style="color: #0000ff;">await</span> _roleRepository.GetAllListAsync(o =&gt; o.Name == StaticRoleNames.Tenants.Admin &amp;&amp; o.TenantId == <span style="color: #0000ff;">null</span><span style="color: #000000;">);
                </span><span style="color: #0000ff;">if</span> (adminRoles.FirstOrDefault() != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
                {
                    </span><span style="color: #0000ff;">var</span> adminRole =<span style="color: #000000;"> adminRoles.FirstOrDefault();

                    </span><span style="color: #0000ff;">var</span> query = CreateFilteredQuery(<span style="color: #0000ff;">new</span> MenusPagedResultRequestDto()).Where(o =&gt; o.TenantId == <span style="color: #0000ff;">null</span> || o.TenantId == <span style="color: #800080;">0</span><span style="color: #000000;">);

                    </span><span style="color: #0000ff;">var</span> systemMenus = <span style="color: #0000ff;">await</span><span style="color: #000000;"> AsyncQueryableExecuter.ToListAsync(query);

                    </span><span style="color: #008000;">//</span><span style="color: #008000;">await _roleManager.ResetAllPermissionsAsync(adminRole.FirstOrDefault()); </span><span style="color: #008000;">//</span><span style="color: #008000;">重置授权</span>

                    <span style="color: #0000ff;">var</span> active_BatchCount = <span style="color: #800080;">10</span><span style="color: #000000;">;
                    </span><span style="color: #0000ff;">var</span> active_permissions = ConvertHostPermissions(systemMenus.Where(o =&gt;<span style="color: #000000;"> o.IsActive).ToList());
                    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; active_permissions.Count(); i += <span style="color: #800080;">10</span>)<span style="color: #008000;">//</span><span style="color: #008000;">每次后移5位</span>
<span style="color: #000000;">                    {
                        </span><span style="color: #008000;">//</span><span style="color: #008000;">await _roleManager.SetGrantedPermissionsAsync(adminRole.FirstOrDefault().Id, active_permissions.Take(active_BatchCount).Skip(i));</span>
                        <span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> notActive_permission <span style="color: #0000ff;">in</span><span style="color: #000000;"> active_permissions.Take(active_BatchCount).Skip(i))
                        {
                            </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.GrantPermissionAsync(adminRole, notActive_permission);
                        }
                        active_BatchCount </span>+= <span style="color: #800080;">10</span>;<span style="color: #008000;">//</span><span style="color: #008000;">每次从数组中选出N+10位，skip前N位</span>
<span style="color: #000000;">                    }

                    </span><span style="color: #0000ff;">var</span> notActive_BatchCount = <span style="color: #800080;">10</span><span style="color: #000000;">;
                    </span><span style="color: #0000ff;">var</span> notActive_permissions = ConvertHostPermissions(systemMenus.Where(o =&gt; !<span style="color: #000000;">o.IsActive).ToList());
                    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; notActive_permissions.Count(); i += <span style="color: #800080;">10</span>)<span style="color: #008000;">//</span><span style="color: #008000;">每次后移5位</span>
<span style="color: #000000;">                    {
                        </span><span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> notActive_permission <span style="color: #0000ff;">in</span><span style="color: #000000;"> notActive_permissions.Take(notActive_BatchCount).Skip(i))
                        {
                            </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.ProhibitPermissionAsync(adminRole, notActive_permission);
                        }
                        notActive_BatchCount </span>+= <span style="color: #800080;">10</span>;<span style="color: #008000;">//</span><span style="color: #008000;">每次从数组中选出N+10位，skip前N位</span>
<span style="color: #000000;">                    }
                }
            }
        }

        </span><span style="color: #0000ff;">public</span> IEnumerable&lt;Permission&gt; ConvertTenantPermissions(IReadOnlyList&lt;AbpMenus&gt;<span style="color: #000000;"> systemMenus)
        {
            </span><span style="color: #0000ff;">return</span> systemMenus.Select(o =&gt; <span style="color: #0000ff;">new</span><span style="color: #000000;"> Permission(o.PageName, L(o.MenuName), L(o.LName), MultiTenancySides.Tenant));
        }

        </span><span style="color: #0000ff;">public</span> IEnumerable&lt;Permission&gt; ConvertHostPermissions(IReadOnlyList&lt;AbpMenus&gt;<span style="color: #000000;"> systemMenus)
        {
            </span><span style="color: #0000ff;">return</span> systemMenus.Select(o =&gt; <span style="color: #0000ff;">new</span><span style="color: #000000;"> Permission(o.PageName, L(o.MenuName), L(o.LName), MultiTenancySides.Host));
        }
        </span><span style="color: #0000ff;">#endregion</span></pre>
</div>
<p>TenantAppService.cs中做一下修改</p>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">async</span> Task&lt;TenantDto&gt;<span style="color: #000000;"> CreateAsync(CreateTenantDto input)
        {
            CheckCreatePermission();

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create tenant</span>
            <span style="color: #0000ff;">var</span> tenant = ObjectMapper.Map&lt;Tenant&gt;<span style="color: #000000;">(input);
            tenant.ConnectionString </span>=<span style="color: #000000;"> input.ConnectionString.IsNullOrEmpty()
                </span>? <span style="color: #0000ff;">null</span><span style="color: #000000;">
                : SimpleStringCipher.Instance.Encrypt(input.ConnectionString);

            </span><span style="color: #0000ff;">var</span> defaultEdition = <span style="color: #0000ff;">await</span><span style="color: #000000;"> _editionManager.FindByNameAsync(EditionManager.DefaultEditionName);
            </span><span style="color: #0000ff;">if</span> (defaultEdition != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                tenant.EditionId </span>=<span style="color: #000000;"> defaultEdition.Id;
            }

            </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _tenantManager.CreateAsync(tenant);
            </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get new tenant's id.

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create tenant database</span>
<span style="color: #000000;">            _abpZeroDbMigrator.CreateOrMigrateForTenant(tenant);

            </span><span style="color: #008000;">//</span><span style="color: #008000;"> We are working entities of new tenant, so changing tenant filter</span>
            <span style="color: #0000ff;">using</span><span style="color: #000000;"> (CurrentUnitOfWork.SetTenantId(tenant.Id))
            {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create static roles for new tenant</span>
                CheckErrors(<span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.CreateStaticRoles(tenant.Id));

                </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get static role ids

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Grant all permissions to admin role</span>
                <span style="color: #0000ff;">var</span> adminRole = _roleManager.Roles.Single(r =&gt; r.Name ==<span style="color: #000000;"> StaticRoleNames.Tenants.Admin);
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _roleManager.GrantAllPermissionsAsync(adminRole);

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Create admin user for the tenant</span>
                <span style="color: #0000ff;">var</span> adminUser =<span style="color: #000000;"> User.CreateTenantAdminUser(tenant.Id, input.AdminEmailAddress);
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.InitializeOptionsAsync(tenant.Id);
                CheckErrors(</span><span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.CreateAsync(adminUser, User.DefaultPassword));
                </span><span style="color: #0000ff;">await</span> CurrentUnitOfWork.SaveChangesAsync(); <span style="color: #008000;">//</span><span style="color: #008000;"> To get admin user's id

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> Assign admin user to role!</span>
                CheckErrors(<span style="color: #0000ff;">await</span><span style="color: #000000;"> _userManager.AddToRoleAsync(adminUser, adminRole.Name));
                </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> CurrentUnitOfWork.SaveChangesAsync();

                </span><span style="color: #ff0000;">await _menusAppService.GiveMenusAsync(new EntityDto&lt;int&gt;() { Id = tenant.Id });
                await CurrentUnitOfWork.SaveChangesAsync();

                await _menusAppService.GivePermissionsAsync(new EntityDto&lt;int&gt;() { Id = tenant.Id });
                await</span><span style="color: #000000;"><span style="color: #ff0000;"> CurrentUnitOfWork.SaveChangesAsync();</span>
            }

            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> MapToEntityDto(tenant);
        }</span></pre>
</div>
<p>现在我们添加租户企业1、企业2</p>
<p><img src="/cnblogs/13096427/789895-20200613151834645-748331091.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="/cnblogs/13096427/789895-20200613151852573-1477272883.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;现在菜单已经同步好了，我们去数据库看下权限的同步</p>
<p><img src="/cnblogs/13096427/789895-20200613152221722-277186366.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>TenantId：</p>
<p>null是Host</p>
<p>1是abp页面第一次加载时初始化的Default租户</p>
<p>2是我之前添加的旧的企业1，那个时候方法没写好，就把2的删掉了</p>
<p>3是企业2</p>
<p>4是企业1</p>
<p>由此可以看出，我们添加的菜单对应的PageName已经作为权限添加到权限表了</p>
<p>&nbsp;</p>
<h2>三、实现菜单修改后，权限赋予对应租户</h2>
<p>这一个其实在二里面已经写好了，前台做一个按钮，赋予权限，调用一下就好了</p>
<p>例如：</p>
<p>Index.cshtml&nbsp; &nbsp;//为什么要加getCurrentLoginInformationsOutput.Tenant == null的判断？是因为租户在进入菜单管理的地方，我们不给他们添加、赋予权限的权限</p>
<p><img src="/cnblogs/13096427/789895-20200613152628601-193312193.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;在/wwwroot/view-resources/Views/Menus/Index.js中添加</p>
<div class="cnblogs_code">
<pre>    $(document).on(<span style="color: #800000;">'</span><span style="color: #800000;">click</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">#GivePermissions</span><span style="color: #800000;">'</span><span style="color: #000000;">, function (e) {
        </span><span style="color: #0000ff;">var</span> tenantId = $(<span style="color: #0000ff;">this</span>).attr(<span style="color: #800000;">'</span><span style="color: #800000;">data-tenant-id</span><span style="color: #800000;">'</span><span style="color: #000000;">);

        abp.message.confirm(
            abp.utils.formatString(
                </span><span style="color: #800000;">"</span><span style="color: #800000;">是否赋予当前租户管理员账号所有权限？</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">系统</span><span style="color: #800000;">"</span><span style="color: #000000;">
            ),
            </span><span style="color: #0000ff;">null</span><span style="color: #000000;">,
            (isConfirmed) </span>=&gt;<span style="color: #000000;"> {
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (isConfirmed) {
                    _menuService
                        .givePermissions({
                            id: tenantId
                        })
                        .done(() </span>=&gt;<span style="color: #000000;"> {
                            abp.notify.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">操作成功！</span><span style="color: #800000;">"</span><span style="color: #000000;">);
                            _$menusTable.ajax.reload();
                        });
                }
            }
        );
    });</span></pre>
</div>
<h2>四、实现菜单的动态加载</h2>
<p>在<a href="https://www.cnblogs.com/wangpengzong/p/13089690.html">https://www.cnblogs.com/wangpengzong/p/13089690.html</a>中我们找到了菜单生成的地方，在最底部，通过<span style="font-family: 'Courier New'; font-size: 12px; white-space: pre-wrap;">NavigationManager来获取到Menus，这里其实有一个初始化方法（</span><span style="font-family: 'Courier New'; font-size: 12px; white-space: pre-wrap;">Initialize</span><span style="font-family: 'Courier New'; font-size: 12px; white-space: pre-wrap;">），调用的是</span><span style="font-family: 'Courier New';"><span style="font-size: 12px; white-space: pre-wrap;">AbpLearnNavigationProvider的</span></span><span style="font-family: 'Courier New'; font-size: 12px; white-space: pre-wrap;">SetNavigation方法来进行本地化，然后在</span></p>
<pre><span style="margin: 0px; padding: 0px; line-height: 1.5 !important;">NavigationManager的非静态构造函数中去获取已经本地化的Menus，但是本地化Menus因为是在初始化时，程序的初始化我们无法获取到当前的Tenant信息，所以只能将获取Menus的地方推迟，放在倒数第二个类</span>UserNavigationManager里面的GetMenuAsync方法中，我们来看下GetMenuAsync</pre>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">async</span> Task&lt;UserMenu&gt; GetMenuAsync(<span style="color: #0000ff;">string</span><span style="color: #000000;"> menuName, UserIdentifier user)
        {
            </span><span style="color: #0000ff;">var</span> menuDefinition =<span style="color: #000000;"> _navigationManager.Menus.GetOrDefault(menuName);
            </span><span style="color: #0000ff;">if</span> (menuDefinition == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
            {
                </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> AbpException(<span style="color: #800000;">"</span><span style="color: #800000;">There is no menu with given name: </span><span style="color: #800000;">"</span> +<span style="color: #000000;"> menuName);
            }

            </span><span style="color: #0000ff;">var</span> userMenu = <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserMenu(menuDefinition, _localizationContext);
            </span><span style="color: #0000ff;">await</span><span style="color: #000000;"> FillUserMenuItems(user, menuDefinition.Items, userMenu.Items);
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> userMenu;
        }</span></pre>
</div>
<p>第一句话获取menuDefinition是关键点，我们将menuDefinition修改为从数据库中获取，在AbpLearn.Application/Authorization/Menus下添加UserNavigationManager.cs</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;"><span style="color: #0000ff;">using Abp;
using Abp.Application.Features;
using Abp.Application.Navigation;
using Abp.Authorization;
using Abp.Dependency;
using Abp.Localization;
using Abp.MultiTenancy;
using Abp.Runtime.Session;
using AbpLearn.Authorization.Menus.Dto;
using AbpLearn.Sessions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AbpLearn.Authorization.Menus
{
    public class UserNavigationManager : IUserNavigationManager, ITransientDependency
    {
        public IAbpSession AbpSession { get; set; }

        private readonly INavigationManager _navigationManager;
        private readonly ILocalizationContext _localizationContext;
        private readonly IIocResolver _iocResolver;
        private readonly IMenusAppService _menuAppService;
        private readonly ISessionAppService _sessionAppService;

        public IDictionary&lt;string, MenuDefinition&gt; Menus { get; private set; }
        public MenuDefinition MainMenu
        {
            get { return Menus["MainMenu"]; }
        }
        public UserNavigationManager(
            INavigationManager navigationManager,
            ILocalizationContext localizationContext,
            IMenusAppService menuAppService,
            ISessionAppService sessionAppService,
            IIocResolver iocResolver)
        {
            _navigationManager = navigationManager;
            _localizationContext = localizationContext;
            _iocResolver = iocResolver;
            AbpSession = NullAbpSession.Instance;
            _menuAppService = menuAppService;
            _sessionAppService = sessionAppService;
        }

        public async Task&lt;UserMenu&gt; GetMenuAsync(string menuName, UserIdentifier user)
        {
            var loginInfo = await _sessionAppService.GetCurrentLoginInformations();

            Menus = new Dictionary&lt;string, MenuDefinition&gt;
                    {
                        {"MainMenu", new MenuDefinition("MainMenu", new LocalizableString("MainMenu", AbpConsts.LocalizationSourceName))}
                    };

            var lists = await _menuAppService.GetAllAsync(new MenusPagedResultRequestDto() { ShowAll = true, TenantId = (loginInfo.Tenant == null ? 0 : loginInfo.Tenant.Id) });
            var ParentMenu = lists.Items.Where(k =&gt; k.IsActive).ToList().Where(x =&gt; x.ParentId == 0).ToList();
            if (ParentMenu.Any())
            {
                ParentMenu.ForEach(g =&gt;
                {
                    var menu = new MenuItemDefinition(
                          g.LName,
                          MenuL(g.MenuName),
                          g.Icon,
                          g.Url,
                          false,
                          g.Orders
                          );
                    BuildSubMenu(menu, g.Id, lists.Items.Where(k =&gt; k.IsActive).ToList());
                    MainMenu.AddItem(menu);
                });
            }
            
            var menuDefinition = MainMenu;
            if (menuDefinition == null)
            {
                throw new AbpException("There is no menu with given name: " + menuName);
            }
            var userMenu = new UserMenu();
            userMenu.Name = menuDefinition.Name;
            userMenu.DisplayName = menuDefinition.DisplayName.Localize(_localizationContext);
            userMenu.CustomData = menuDefinition.CustomData;
            userMenu.Items = new List&lt;UserMenuItem&gt;();
            await FillUserMenuItems(user, menuDefinition.Items, userMenu.Items);
            return userMenu;
        }

        public async Task&lt;IReadOnlyList&lt;UserMenu&gt;&gt; GetMenusAsync(UserIdentifier user)
        {
            var userMenus = new List&lt;UserMenu&gt;();

            foreach (var menu in _navigationManager.Menus.Values)
            {
                userMenus.Add(await GetMenuAsync(menu.Name, user));
            }

            return userMenus;
        }
        public void BuildSubMenu(MenuItemDefinition menu, int parentId, List&lt;MenuDto&gt; list)
        {
            var nList = list.Where(x =&gt; x.ParentId == parentId).ToList();
            if (nList != null &amp;&amp; nList.Count &gt; 0)
            {
                nList.ForEach(g =&gt;
                {
                    var subMenu = new MenuItemDefinition(
                         g.PageName,
                        MenuL(g.MenuName),
                        g.Icon,
                        g.Url,
                        false,
                      g.Orders
                        );
                    menu.AddItem(subMenu);
                    BuildSubMenu(subMenu, g.Id, list);
                });
            }
        }

        private static ILocalizableString MenuL(string name)
        {
            return new LocalizableString(name, AbpLearnConsts.LocalizationSourceName);
        }
        private async Task&lt;int&gt; FillUserMenuItems(UserIdentifier user, IList&lt;MenuItemDefinition&gt; menuItemDefinitions, IList&lt;UserMenuItem&gt; userMenuItems)
        {
            //TODO: Can be optimized by re-using FeatureDependencyContext.

            var addedMenuItemCount = 0;

            using (var scope = _iocResolver.CreateScope())
            {
                var permissionDependencyContext = scope.Resolve&lt;PermissionDependencyContext&gt;();
                permissionDependencyContext.User = user;

                var featureDependencyContext = scope.Resolve&lt;FeatureDependencyContext&gt;();
                featureDependencyContext.TenantId = user == null ? null : user.TenantId;

                foreach (var menuItemDefinition in menuItemDefinitions)
                {
                    if (menuItemDefinition.RequiresAuthentication &amp;&amp; user == null)
                    {
                        continue;
                    }

                    if (menuItemDefinition.PermissionDependency != null &amp;&amp;
                        (user == null || !(await menuItemDefinition.PermissionDependency.IsSatisfiedAsync(permissionDependencyContext))))
                    {
                        continue;
                    }

                    if (menuItemDefinition.FeatureDependency != null &amp;&amp;
                        (AbpSession.MultiTenancySide == MultiTenancySides.Tenant || (user != null &amp;&amp; user.TenantId != null)) &amp;&amp;
                        !(await menuItemDefinition.FeatureDependency.IsSatisfiedAsync(featureDependencyContext)))
                    {
                        continue;
                    }

                    var userMenuItem = new UserMenuItem(menuItemDefinition, _localizationContext);
                    if (menuItemDefinition.IsLeaf || (await FillUserMenuItems(user, menuItemDefinition.Items, userMenuItem.Items)) &gt; 0)
                    {
                        userMenuItems.Add(userMenuItem);
                        ++addedMenuItemCount;
                    }
                }
            }

            return addedMenuItemCount;
        }
    }
}</span></span></pre>
<p><span style="color: #0000ff;">&nbsp;</span></p>
</div>
<p>然后在Mvc项目的Startup.cs/ConfigureServices下增加</p>
<div class="cnblogs_code">
<pre>            services.AddScoped&lt;IUserNavigationManager, UserNavigationManager&gt;();</pre>
</div>
<p>因为在abp中菜单被做做成了模块，在程序初始化时模块添加进去，但是我们将菜单修改成了每次读取数据库加载，那么我们就不需要加载这个模块了<span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px;"><br /></span></p>
<p>在mvc项目的AbpLearnWebMvcModule.cs注释下面这句话</p>
<div class="cnblogs_code">
<pre>            <span style="color: #008000;">//</span><span style="color: #008000;">Configuration.Navigation.Providers.Add&lt;AbpLearnNavigationProvider&gt;();</span></pre>
</div>
<p>将AbpLearnNavigationProvider.cs/SetNavigation方法的内容全部注释掉</p>
<p>预览一下mvc，用Host登录一下</p>
<p><img src="/cnblogs/13096427/789895-20200613155431331-1058862470.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;用企业1登陆下，登录切换Host和Tenant，是在登录界面&nbsp;<span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">Current tenant:&nbsp;</span><span style="box-sizing: border-box; color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">未选</span><span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">&nbsp;(</span><a style="box-sizing: border-box; color: #007bff; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;" data-toggle="modal" data-target="#TenantChangeModal">Change</a><span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">) 点击Change，在弹框中输入 E1（因为上面设置的企业1标识是E1），点击save，页面刷新后就变为了&nbsp;</span><span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">Current tenant:&nbsp;</span><span style="box-sizing: border-box; color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;" title="企业1"><span style="box-sizing: border-box; font-weight: bolder;">E1</span></span><span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">&nbsp;(</span><a style="box-sizing: border-box; color: #007bff; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;" data-toggle="modal" data-target="#TenantChangeModal">Change</a><span style="color: #212529; font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; text-align: center;">) ，输入账号密码登录</span></p>
<p>&nbsp;<img src="/cnblogs/13096427/789895-20200613164737035-1698740974.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;OK，我们的动态菜单已经完成了</p>
<p>&nbsp;</p>
<h2>添加jstree</h2>
<p>&nbsp;当然，我的菜单使用的是table来显示，你也可以使用tree来，我找到了一个jstree，下面修改一下</p>
<p>MenusAppService.cs</p>
<div class="cnblogs_code">
<pre>        <span style="color: #0000ff;">#region</span> 获取当前账户的菜单树
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 获取当前账户的菜单树
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="input"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">async</span> Task&lt;<span style="color: #0000ff;">string</span>&gt;<span style="color: #000000;"> GetTreeAsync(MenusPagedResultRequestDto input)
        {
            </span><span style="color: #0000ff;">var</span> query = CreateFilteredQuery(<span style="color: #0000ff;">new</span> MenusPagedResultRequestDto()).Where(o =&gt; o.TenantId ==<span style="color: #000000;"> input.TenantId);

            </span><span style="color: #0000ff;">var</span> systemMenus = <span style="color: #0000ff;">await</span><span style="color: #000000;"> AsyncQueryableExecuter.ToListAsync(query);

            </span><span style="color: #0000ff;">var</span> childJObject = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JObject();
            </span><span style="color: #0000ff;">var</span> openJObject = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JObject();
            openJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">opened</span><span style="color: #800000;">"</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">);
            childJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>, <span style="color: #800080;">0</span><span style="color: #000000;">);
            childJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">根目录</span><span style="color: #800000;">"</span><span style="color: #000000;">);
            childJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">icon</span><span style="color: #800000;">"</span>, <span style="color: #800000;">""</span><span style="color: #000000;">);
            childJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">state</span><span style="color: #800000;">"</span><span style="color: #000000;">, openJObject);
            childJObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">children</span><span style="color: #800000;">"</span>, GetJArray(systemMenus, <span style="color: #800080;">0</span><span style="color: #000000;">));
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> childJObject.ToString();
        }

        </span><span style="color: #0000ff;">#region</span> 获取目录Array
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span>
        <span style="color: #808080;">///</span><span style="color: #008000;"> 获取目录Array
        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="systemMenus"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name="parentdId"&gt;&lt;/param&gt;</span>
        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color: #0000ff;">private</span> JArray GetJArray(List&lt;AbpMenus&gt; systemMenus, <span style="color: #0000ff;">int</span><span style="color: #000000;"> parentdId)
        {
            JArray jArray </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> JArray();
            </span><span style="color: #0000ff;">foreach</span> (<span style="color: #0000ff;">var</span> menu <span style="color: #0000ff;">in</span> systemMenus.Where(o =&gt; o.ParentId ==<span style="color: #000000;"> parentdId))
            {
                </span><span style="color: #0000ff;">var</span> jObject = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JObject();
                jObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span><span style="color: #000000;">, menu.Id);
                jObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span><span style="color: #000000;">, menu.MenuName);
                jObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">icon</span><span style="color: #800000;">"</span><span style="color: #000000;">, menu.Icon);
                </span><span style="color: #008000;">//</span><span style="color: #008000;">jObject.Add("state", menu.Icon);</span>
                <span style="color: #0000ff;">if</span> (systemMenus.Any(o =&gt; o.ParentId ==<span style="color: #000000;"> menu.Id))
                {
                    jObject.Add(</span><span style="color: #800000;">"</span><span style="color: #800000;">children</span><span style="color: #800000;">"</span><span style="color: #000000;">, GetJArray(systemMenus, menu.Id));
                }
                jArray.Add(jObject);
            }
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> jArray;
        }

        </span><span style="color: #0000ff;">#endregion</span>

        <span style="color: #0000ff;">#endregion</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;前端Index.cshtml&nbsp;&nbsp;<span style="color: #800000; font-family: 'Courier New'; font-size: 12px;">jstree去</span><span style="color: #800000; font-family: 'Courier New';"><span style="font-size: 12px;">https://github.com/vakata/jstree/zipball/3.3.8下载，下载后在mvc项目的wwwroot文件夹下添加jstree文件夹，下载文件的src里面内容全部赋值到jstree文件夹</span></span></p>
<p>注释掉table标签</p>
<p>添加<span style="color: #800000; font-family: 'Courier New'; font-size: 12px;">jstree1</span></p>
<p>例如：</p>
<div class="cnblogs_code">
<pre>@section styles
{
    &lt;link href="~/jstree/themes/default/style.css" rel="stylesheet" /&gt;
}                     <br /><br />       &lt;div id=<span style="color: #800000;">"</span><span style="color: #800000;">jstree1</span><span style="color: #800000;">"</span> style=<span style="color: #800000;">"</span><span style="color: #800000;">width:100%;</span><span style="color: #800000;">"</span>&gt;&lt;/div&gt;



@section scripts
{
    &lt;environment names="Development"&gt;
        &lt;script src="~/view-resources/Views/Menus/Index.js" asp-append-version="true"&gt;&lt;/script&gt;
    &lt;/environment&gt;

    &lt;environment names="Staging,Production"&gt;
        &lt;script src="~/view-resources/Views/Menus/Index.min.js" asp-append-version="true"&gt;&lt;/script&gt;
    &lt;/environment&gt;
    &lt;script type="application/javascript" src="~/jstree/jstree.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" src="~/jstree/jstree.contextmenu.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        $(function () {
            var _menuService = abp.services.app.menus;

            l = abp.localization.getSource('A_b_p');

            $('#jstree1').jstree({
                "core": {
                    "data": function (node, callback) {
                        var filter = $('#MenusSearchForm').serializeFormToObject(true);
                        this, _menuService.getTree(filter).done(function (result) {
                            callback.call(this, JSON.parse(result));
                        });
                    },
                    "themes": {
                        "variant": "large",//加大
                        "ellipsis": true //文字多时省略
                    },
                    "check_callback": true,
                },
                "plugins": ["contextmenu", "wholerow", "themes"],//"checkbox"
                "contextmenu": {
                    select_node: false,
                    show_at_node: true,
                    "items": {
                        "create": {
                            "label": "新增子菜单",
                            "action": function (obj) {
                                var inst = jQuery.jstree.reference(obj.reference);
                                var clickedNode = inst.get_node(obj.reference);
                                if (parseInt(clickedNode.original.id) &gt;= 0) {
                                    $("#ParentId").val(clickedNode.original.id);
                                    $("#MenuCreateModal").modal();
                                } else {
                                    abp.notify.info("父节点获取出错");
                                }
                            },
                        },
                        "rename": {
                            "label": "修改",
                            "action": function (obj) {
                                var inst = jQuery.jstree.reference(obj.reference);
                                var clickedNode = inst.get_node(obj.reference);
                                if (parseInt(clickedNode.original.id) &gt;= 0) {
                                    abp.ajax({
                                        url: abp.appPath + 'Menus/EditModal?menuId=' + clickedNode.original.id,
                                        type: 'POST',
                                        dataType: 'html',
                                        success: function (content) {
                                            $("#MenuEditModal").modal();
                                            $('#MenuEditModal div.modal-content').html(content);
                                        },
                                        error: function (e) { }
                                    });
                                } else {
                                    abp.notify.info("菜单获取出错");
                                }
                            }
                        },
                        "delete": {
                            "label": "更改菜单状态",
                            "action": function (obj) {
                                var inst = jQuery.jstree.reference(obj.reference);
                                var clickedNode = inst.get_node(obj.reference);
                                abp.message.confirm(
                                    abp.utils.formatString("是否" + (clickedNode.original.state.disabled?"启用":"禁用") + "当前菜单：" + clickedNode.original.text + "?"),
                                    null,
                                    (isConfirmed) =&gt; {
                                        if (isConfirmed) {
                                            _menuService
                                                .delete({
                                                    id: clickedNode.original.id
                                                })
                                                .done(() =&gt; {
                                                    abp.notify.info(l('SuccessfullyDeleted'));
                                                    location.reload();
                                                });
                                        }
                                    }
                                );
                            },

                        }
                    }
                }
            }).on('select_node.jstree', function (event, data) {
                console.log(data.node);
            }).on('changed.jstree', function (event, data) {
                console.log("-----------changed.jstree");
                console.log("action:" + data.action);
                console.log(data.node);
            });

        });


    &lt;/script&gt;
}
</pre>
<p>&nbsp;</p>
</div>
<p>&nbsp;预览一下吧</p>
<p><img src="/cnblogs/13096427/789895-20200613175433971-1845076483.png" alt="" loading="lazy" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>github地址</h2>
<p>本文github：<a href="https://github.com/wangpengzong/AbpLearn">https://github.com/wangpengzong/AbpLearn</a></p>
<p>下一篇开始动态权限</p>
<h2 style="display: none;">&nbsp;吐槽区域（写的不好、不对，欢迎吐槽）</h2>