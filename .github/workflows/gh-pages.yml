name: Build gh-pages

on:
  push:
    tags:
      - "gh-v*.*.*"  # åé¢æ¯æ¬¡æ›´æ–°æäº¤ï¼Œåªæœ‰æ‰“ä¸Štagä¹‹åæ‰ä¼šè¿›è¡Œå‘å¸ƒæ›´æ–°ï¼Œå‡å°‘actionsæ‰§è¡Œæ¬¡æ•°
      - "v*.*.*"  # åé¢æ¯æ¬¡æ›´æ–°æäº¤ï¼Œåªæœ‰æ‰“ä¸Štagä¹‹åæ‰ä¼šè¿›è¡Œå‘å¸ƒæ›´æ–°ï¼Œå‡å°‘actionsæ‰§è¡Œæ¬¡æ•°
  workflow_dispatch:

jobs:
  build:
    env:
      CNBLOGS_ISDOWN: ${{secrets.CNBLOGS_ISDOWN}}
      CNBLOGS_COOKIE: ${{secrets.CNBLOGS_COOKIE}}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v2
        with:
          ref: master

      - name: Setup Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '16.15.0'

      - name: Set up Go 1.18.3
        if: ${{ env.CNBLOGS_ISDOWN == 'true' }}  # æ˜¯å¦ä»åšå®¢å›­ä¸‹è½½ï¼Œå¯é€šè¿‡æ›´æ”¹CNBLOGS_ISDOWNçš„å€¼è¿›è¡Œæäº¤æ—¶çš„ä¸‹è½½æ§åˆ¶
        uses: actions/setup-go@v1
        with:
          go-version: 1.18.3
        id: go
      - name: Pull blogs from cnblogs
        if: ${{ env.CNBLOGS_ISDOWN == 'true' }}  # æ˜¯å¦ä»åšå®¢å›­ä¸‹è½½ï¼Œå¯é€šè¿‡æ›´æ”¹CNBLOGS_ISDOWNçš„å€¼è¿›è¡Œæäº¤æ—¶çš„ä¸‹è½½æ§åˆ¶
        run: |
          cd source/_posts/
          go run downmyblogs.go -cookie ${{env.CNBLOGS_COOKIE}}

      - name: Setup Hexo
        run: |
          npm install hexo-cli -g
          npm install hexo-generator-search --save
          npm install hexo-generator-feed --save
          npm i hexo-wordcount
          npm install
      - name: Deploy and Build Image
        run: |
          hexo clean
          hexo deploy
          ls -la
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: public # The folder the action should deploy.


